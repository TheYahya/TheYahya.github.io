<!doctype html><html lang=en-us><head><link rel=preload href=/lib/font-awesome/webfonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/font-awesome/webfonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/font-awesome/webfonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/JetBrainsMono/web/woff2/JetBrainsMono-Regular.woff2 as=font type=font/woff2 crossorigin=anonymous><script type=text/javascript src=https://latest.cactus.chat/cactus.js></script>
<link rel=stylesheet href=https://latest.cactus.chat/style.css type=text/css><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>A Deep Look Into Golang Profile-Guided Optimization (PGO) | Yahya SayadArbabi - Blog</title><link rel=canonical href=https://theyahya.com/posts/go-pgo/><meta name=description content="I like ðŸ–¥ Computers, ðŸ“š Books, and ðŸŽ¥ Movies! I will be writing about them here."><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="all,follow"><meta name=googlebot content="index,follow,snippet,archive"><meta property="og:title" content="A Deep Look Into Golang Profile-Guided Optimization (PGO)"><meta property="og:description" content="Intro Profile-Guided Optimization (PGO) is an optimization method which improves final compiled binary by using profile data hints and compiling the code based on those profiles.
There are several optimization mechanisms that compilers usually get into account when compiling your code to binary. Like dead code elimination, Register allocation, Constant folding or function inlining; you may split your code into smaller and smaller functions and different level of abstractions to ease up future changes and modifications, but from compiler point of view multiple calls to different functions may not be very optimize and sometimes compiler decides to inline your functions!"><meta property="og:type" content="article"><meta property="og:url" content="https://theyahya.com/posts/go-pgo/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-08-23T00:00:00+00:00"><meta property="article:modified_time" content="2023-08-23T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="A Deep Look Into Golang Profile-Guided Optimization (PGO)"><meta name=twitter:description content="Intro Profile-Guided Optimization (PGO) is an optimization method which improves final compiled binary by using profile data hints and compiling the code based on those profiles.
There are several optimization mechanisms that compilers usually get into account when compiling your code to binary. Like dead code elimination, Register allocation, Constant folding or function inlining; you may split your code into smaller and smaller functions and different level of abstractions to ease up future changes and modifications, but from compiler point of view multiple calls to different functions may not be very optimize and sometimes compiler decides to inline your functions!"><link rel=stylesheet href=https://theyahya.com/css/styles.94f653e9e151e28067a7c5dbbc4600cbd5a3c721e79faaf971e523c40f3b249b8e4f20bb57810dfffa8d559ca5c140fd56eb4cd9c0853113ad08e66afdb08bdd.css integrity="sha512-lPZT6eFR4oBnp8XbvEYAy9WjxyHnn6r5ceUjxA87JJuOTyC7V4EN//qNVZylwUD9VutM2cCFMROtCOZq/bCL3Q=="><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js></script>
<script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]--><link rel=icon type=image/png href=https://theyahya.com/images/favicon.ico><script async src="https://www.googletagmanager.com/gtag/js?id=G-SZWG7TS62Y"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-SZWG7TS62Y",{anonymize_ip:!1})}</script></head><body class="max-width mx-auto px3 ltr"><div class="content index py4"><div id=header-post><a id=menu-icon href=#><i class="fas fa-bars fa-lg"></i></a>
<a id=menu-icon-tablet href=#><i class="fas fa-bars fa-lg"></i></a>
<a id=top-icon-tablet href=# onclick='$("html, body").animate({scrollTop:0},"fast")' style=display:none aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg"></i></a>
<span id=menu><span id=nav><ul><li><a href=/>Home</a></li><li><a href=/about>About</a></li><li><a href=https://theyahya.substack.com/>ðŸ“® Newsletter</a></li></ul></span><br><span id=actions><ul><li><a class=icon href=https://theyahya.com/about/ aria-label=Previous><i class="fas fa-chevron-left" aria-hidden=true onmouseover='$("#i-prev").toggle()' onmouseout='$("#i-prev").toggle()'></i></a></li><li><a class=icon href=# onclick='$("html, body").animate({scrollTop:0},"fast")' aria-label="Top of Page"><i class="fas fa-chevron-up" aria-hidden=true onmouseover='$("#i-top").toggle()' onmouseout='$("#i-top").toggle()'></i></a></li><li><a class=icon href=# aria-label=Share><i class="fas fa-share-alt" aria-hidden=true onmouseover='$("#i-share").toggle()' onmouseout='$("#i-share").toggle()' onclick='return $("#share").toggle(),!1'></i></a></li></ul><span id=i-prev class=info style=display:none>Previous post</span>
<span id=i-next class=info style=display:none>Next post</span>
<span id=i-top class=info style=display:none>Back to top</span>
<span id=i-share class=info style=display:none>Share post</span></span><br><div id=share style=display:none><ul><li><a class=icon href="http://www.facebook.com/sharer.php?u=https%3a%2f%2ftheyahya.com%2fposts%2fgo-pgo%2f" aria-label=Facebook><i class="fab fa-facebook" aria-hidden=true></i></a></li><li><a class=icon href="https://twitter.com/share?url=https%3a%2f%2ftheyahya.com%2fposts%2fgo-pgo%2f&text=A%20Deep%20Look%20Into%20Golang%20Profile-Guided%20Optimization%20%28PGO%29" aria-label=Twitter><i class="fab fa-twitter" aria-hidden=true></i></a></li><li><a class=icon href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2ftheyahya.com%2fposts%2fgo-pgo%2f&title=A%20Deep%20Look%20Into%20Golang%20Profile-Guided%20Optimization%20%28PGO%29" aria-label=Linkedin><i class="fab fa-linkedin" aria-hidden=true></i></a></li><li><a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2ftheyahya.com%2fposts%2fgo-pgo%2f&is_video=false&description=A%20Deep%20Look%20Into%20Golang%20Profile-Guided%20Optimization%20%28PGO%29" aria-label=Pinterest><i class="fab fa-pinterest" aria-hidden=true></i></a></li><li><a class=icon href="mailto:?subject=A%20Deep%20Look%20Into%20Golang%20Profile-Guided%20Optimization%20%28PGO%29&body=Check out this article: https%3a%2f%2ftheyahya.com%2fposts%2fgo-pgo%2f" aria-label=Email><i class="fas fa-envelope" aria-hidden=true></i></a></li><li><a class=icon href="https://getpocket.com/save?url=https%3a%2f%2ftheyahya.com%2fposts%2fgo-pgo%2f&title=A%20Deep%20Look%20Into%20Golang%20Profile-Guided%20Optimization%20%28PGO%29" aria-label=Pocket><i class="fab fa-get-pocket" aria-hidden=true></i></a></li><li><a class=icon href="http://reddit.com/submit?url=https%3a%2f%2ftheyahya.com%2fposts%2fgo-pgo%2f&title=A%20Deep%20Look%20Into%20Golang%20Profile-Guided%20Optimization%20%28PGO%29" aria-label=reddit><i class="fab fa-reddit" aria-hidden=true></i></a></li><li><a class=icon href="http://www.tumblr.com/share/link?url=https%3a%2f%2ftheyahya.com%2fposts%2fgo-pgo%2f&name=A%20Deep%20Look%20Into%20Golang%20Profile-Guided%20Optimization%20%28PGO%29&description=Intro%20Profile-Guided%20Optimization%20%28PGO%29%20is%20an%20optimization%20method%20which%20improves%20final%20compiled%20binary%20by%20using%20profile%20data%20hints%20and%20compiling%20the%20code%20based%20on%20those%20profiles.%0aThere%20are%20several%20optimization%20mechanisms%20that%20compilers%20usually%20get%20into%20account%20when%20compiling%20your%20code%20to%20binary.%20Like%20dead%20code%20elimination%2c%20Register%20allocation%2c%20Constant%20folding%20or%20function%20inlining%3b%20you%20may%20split%20your%20code%20into%20smaller%20and%20smaller%20functions%20and%20different%20level%20of%20abstractions%20to%20ease%20up%20future%20changes%20and%20modifications%2c%20but%20from%20compiler%20point%20of%20view%20multiple%20calls%20to%20different%20functions%20may%20not%20be%20very%20optimize%20and%20sometimes%20compiler%20decides%20to%20inline%20your%20functions%21" aria-label=Tumblr><i class="fab fa-tumblr" aria-hidden=true></i></a></li><li><a class=icon href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2ftheyahya.com%2fposts%2fgo-pgo%2f&t=A%20Deep%20Look%20Into%20Golang%20Profile-Guided%20Optimization%20%28PGO%29" aria-label="Hacker News"><i class="fab fa-hacker-news" aria-hidden=true></i></a></li></ul></div></span></div><article class=post itemscope itemtype=http://schema.org/BlogPosting><header><h1 class=posttitle itemprop="name headline">A Deep Look Into Golang Profile-Guided Optimization (PGO)</h1><div class=meta><div class=postdate><time datetime="2023-08-23 00:00:00 +0000 UTC" itemprop=datePublished>2023-08-23</time></div><div class=article-category><i class="fas fa-archive"></i>
<a class=category-link href=/categories/programming>Programming</a>
,
<a class=category-link href=/categories/golang>Golang</a></div><div class=article-tag><i class="fas fa-tag"></i>
<a class=tag-link href=/tags/golang rel=tag>golang</a>
,
<a class=tag-link href=/tags/pgo rel=tag>pgo</a>
,
<a class=tag-link href=/tags/performance rel=tag>performance</a>
,
<a class=tag-link href=/tags/compiler rel=tag>compiler</a></div></div></header><div id=toc><nav id=TableOfContents><ul><li><a href=#intro>Intro</a></li><li><a href=#how-does-it-work>How does it work?</a></li><li><a href=#dig-deeper-inside-the-binaries>Dig deeper inside the binaries!</a></li><li><a href=#a-more-realistic-example-api>A more realistic example (API)</a></li><li><a href=#automation--workflow>Automation & Workflow</a></li><li><a href=#code>Code</a></li><li><a href=#recommended-related-reading>Recommended related reading</a></li></ul></nav></div><div class=content itemprop=articleBody><h2 id=intro>Intro</h2><p>Profile-Guided Optimization (PGO) is an optimization method which improves final compiled binary by using profile data hints and compiling the code based on those profiles.</p><p>There are several optimization mechanisms that compilers usually get into account when compiling your code to binary. Like dead code elimination, Register allocation, Constant folding or function inlining; you may split your code into smaller and smaller functions and different level of abstractions to ease up future changes and modifications, but from compiler point of view multiple calls to different functions may not be very optimize and sometimes compiler decides to inline your functions!</p><p>Although there&rsquo;s a limit to these optimizations. Compiler can&rsquo;t inline everything! this will result in bloating binary files, l-cache overhead and performance degradation. But with providing information about how the program is being run and which functions are being constantly called, the compiler can inline those hot functions and reduce function call and return overhead. It&rsquo;s the same with register allocation and other methods.</p><h2 id=how-does-it-work>How does it work?</h2><p>From go version <code>v1.21</code>, you only need to provide:</p><ol><li>A pprof CPU profile, which can be collect with <code>runtime/pprof</code> or <code>net/http/pprof</code></li><li>Renaming it to <code>default.pgo</code> and move it to same directory as <code>main.go</code> or pass it to <code>pgo</code> flag in <code>go build</code> command</li></ol><p>Let&rsquo;s take a look at the following code and see how it works:</p><div class=highlight><div style=color:#93a1a1;background-color:#002b36;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">28
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#719e07>package</span> main
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#719e07>import</span> (
</span></span><span style=display:flex><span>        <span style=color:#2aa198>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#2aa198>&#34;os&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#2aa198>&#34;runtime/pprof&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#268bd2>func</span> <span style=color:#268bd2>main</span>() {
</span></span><span style=display:flex><span>        <span style=color:#586e75>// These 4 lines simply collect profile data into default.pgo file
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>        f, _ <span style=color:#719e07>:=</span> os.<span style=color:#268bd2>Create</span>(<span style=color:#2aa198>&#34;default.pgo&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#719e07>defer</span> f.<span style=color:#268bd2>Close</span>()
</span></span><span style=display:flex><span>        pprof.<span style=color:#268bd2>StartCPUProfile</span>(f)
</span></span><span style=display:flex><span>        <span style=color:#719e07>defer</span> pprof.<span style=color:#268bd2>StopCPUProfile</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#719e07>for</span> i <span style=color:#719e07>:=</span> <span style=color:#2aa198>0</span>; i <span style=color:#719e07>&lt;=</span> <span style=color:#2aa198>1_000_000</span>; i<span style=color:#719e07>++</span> {
</span></span><span style=display:flex><span>                <span style=color:#268bd2>Func1</span>()
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#268bd2>func</span> <span style=color:#268bd2>Func1</span>() {
</span></span><span style=display:flex><span>        fmt.<span style=color:#268bd2>Println</span>(<span style=color:#2aa198>&#34;print in func #1&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#268bd2>Func2</span>()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#268bd2>func</span> <span style=color:#268bd2>Func2</span>() {
</span></span><span style=display:flex><span>        fmt.<span style=color:#268bd2>Println</span>(<span style=color:#2aa198>&#34;print in func #2&#34;</span>)
</span></span><span style=display:flex><span>}</span></span></code></pre></td></tr></table></div></div><p>By running <code>go build -o before_pgo ./main.go</code> we compile the code and create the <code>before_pgo</code> file in the same directory and by running that binary with <code>./before_pgo</code> we can create the <code>default.pgo</code> that we need to optimize our binary.</p><p>Before going any further, let&rsquo;s see how the compiler uses our fancy <code>default.pgo</code> file to improve things. By running <code>go build -pgo=off -gcflags -m main.go</code> we get the following results: <code>-gcflags -m</code> flag is to see compiler optimizations and since we already have <code>default.pgo</code> we need to use <code>-pgo=off</code> to not use it for now.</p><div class=highlight><div style=color:#93a1a1;background-color:#002b36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;display:grid><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;display:grid><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 1
</span><span style=background-color:#19404a><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 2
</span></span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">13
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;display:grid><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#586e75># command-line-arguments</span>
</span></span><span style=display:flex;background-color:#19404a><span>./main.go:26:6: can inline Func2
</span></span><span style=display:flex><span>./main.go:27:13: inlining call to fmt.Println
</span></span><span style=display:flex><span>./main.go:22:13: inlining call to fmt.Println
</span></span><span style=display:flex><span>./main.go:23:7: inlining call to Func2
</span></span><span style=display:flex><span>./main.go:23:7: inlining call to fmt.Println
</span></span><span style=display:flex><span>./main.go:11:19: inlining call to os.Create
</span></span><span style=display:flex><span>./main.go:22:13: ... argument does not escape
</span></span><span style=display:flex><span>./main.go:22:14: <span style=color:#2aa198>&#34;print in func #1&#34;</span> escapes to heap
</span></span><span style=display:flex><span>./main.go:23:7: ... argument does not escape
</span></span><span style=display:flex><span>./main.go:23:7: <span style=color:#2aa198>&#34;print in func #2&#34;</span> escapes to heap
</span></span><span style=display:flex><span>./main.go:27:13: ... argument does not escape
</span></span><span style=display:flex><span>./main.go:27:14: <span style=color:#2aa198>&#34;print in func #2&#34;</span> escapes to heap</span></span></code></pre></td></tr></table></div></div><p>As you can see, the compiler is inlining a lot of things, such as our <code>Func2</code>, Very good without any PGO, right?</p><p>Now Let&rsquo;s try it out with fancy <code>-pgo</code> option, Running <code>go build -pgo=auto -gcflags -m main.go</code> will give us:</p><div class=highlight><div style=color:#93a1a1;background-color:#002b36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;display:grid><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;display:grid><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 3
</span><span style=background-color:#19404a><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 4
</span></span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">16
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;display:grid><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#586e75># command-line-arguments</span>
</span></span><span style=display:flex><span>./main.go:26:6: can inline Func2
</span></span><span style=display:flex><span>./main.go:27:13: inlining call to fmt.Println
</span></span><span style=display:flex;background-color:#19404a><span>./main.go:21:6: can inline Func1
</span></span><span style=display:flex><span>./main.go:22:13: inlining call to fmt.Println
</span></span><span style=display:flex><span>./main.go:23:7: inlining call to Func2
</span></span><span style=display:flex><span>./main.go:11:19: inlining call to os.Create
</span></span><span style=display:flex><span>./main.go:17:8: inlining call to Func1
</span></span><span style=display:flex><span>./main.go:27:13: ... argument does not escape
</span></span><span style=display:flex><span>./main.go:27:14: <span style=color:#2aa198>&#34;print in func #2&#34;</span> escapes to heap
</span></span><span style=display:flex><span>./main.go:17:8: ... argument does not escape
</span></span><span style=display:flex><span>./main.go:17:8: <span style=color:#2aa198>&#34;print in func #1&#34;</span> escapes to heap
</span></span><span style=display:flex><span>./main.go:22:13: ... argument does not escape
</span></span><span style=display:flex><span>./main.go:22:14: <span style=color:#2aa198>&#34;print in func #1&#34;</span> escapes to heap
</span></span><span style=display:flex><span>./main.go:23:7: ... argument does not escape
</span></span><span style=display:flex><span>./main.go:23:7: <span style=color:#2aa198>&#34;print in func #2&#34;</span> escapes to heap</span></span></code></pre></td></tr></table></div></div><p>Now we can see that our <code>Func1</code> is also inlined, And why is that? It&rsquo;s because by default, go compiler doesn&rsquo;t inline any non-leaf function. But by providing some profile data and telling it how our program is actually working! It understands that we&rsquo;re calling that function 1,000,000 times and it&rsquo;s better to be inlined.</p><h2 id=dig-deeper-inside-the-binaries>Dig deeper inside the binaries!</h2><p>Now let&rsquo;s compile our code, this time with profile data that we have and compare the binaries. Now that we have <code>default.pgo</code> in the same directory as <code>main.go</code>, let&rsquo;s run <code>go build -o after_pgo ./main.go</code> and first of all, let&rsquo;s compare the size of our binaries by running <code>ls -atrl</code> we get:</p><div class=highlight><div style=color:#93a1a1;background-color:#002b36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;display:grid><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;display:grid><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">4
</span><span style=background-color:#19404a><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">5
</span></span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">6
</span><span style=background-color:#19404a><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">7
</span></span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">8
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;display:grid><code class=language-bash data-lang=bash><span style=display:flex><span> total <span style=color:#2aa198>4424</span>
</span></span><span style=display:flex><span>drwxr-xr-x <span style=color:#2aa198>4</span> yahya yahya    <span style=color:#2aa198>4096</span> Aug <span style=color:#2aa198>18</span> 18:25 ..
</span></span><span style=display:flex><span>-rw-r--r-- <span style=color:#2aa198>1</span> yahya yahya      <span style=color:#2aa198>65</span> Aug <span style=color:#2aa198>18</span> 18:25 go.mod
</span></span><span style=display:flex><span>-rw-r--r-- <span style=color:#2aa198>1</span> yahya yahya     <span style=color:#2aa198>407</span> Aug <span style=color:#2aa198>18</span> 18:26 main.go
</span></span><span style=display:flex;background-color:#19404a><span>-rwxr-xr-x <span style=color:#2aa198>1</span> yahya yahya <span style=color:#2aa198>2250107</span> Aug <span style=color:#2aa198>18</span> 18:41 before_pgo
</span></span><span style=display:flex><span>-rw-r--r-- <span style=color:#2aa198>1</span> yahya yahya    <span style=color:#2aa198>2639</span> Aug <span style=color:#2aa198>18</span> 18:44 default.pgo
</span></span><span style=display:flex;background-color:#19404a><span>-rwxr-xr-x <span style=color:#2aa198>1</span> yahya yahya <span style=color:#2aa198>2252917</span> Aug <span style=color:#2aa198>18</span> 19:02 after_pgo
</span></span><span style=display:flex><span>drwxr-xr-x <span style=color:#2aa198>2</span> yahya yahya    <span style=color:#2aa198>4096</span> Aug <span style=color:#2aa198>18</span> 19:06 .</span></span></code></pre></td></tr></table></div></div><p><code>after_pgo</code> file is slightly bigger, and we know that&rsquo;s because of some inlining. Let&rsquo;s checkout inside these binaries and see what we can find. I&rsquo;m going to use <code>objdump</code> that exists in the go tool chain, so we can run <code>go tool objdump before_pgo</code> and <code>go tool objdump after_pgo</code> and compare the result. The following is only the part of inlining the <code>Func1</code> version.</p><p>The following is before and after pgo objdump binaries:<div class=highlight><div style=color:#93a1a1;background-color:#002b36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;display:grid><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;display:grid><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">31
</span><span style=background-color:#19404a><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">32
</span></span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">52
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;display:grid><code class=language-bash data-lang=bash><span style=display:flex><span>// before_pgo
</span></span><span style=display:flex><span>TEXT main.main<span style=color:#719e07>(</span>SB<span style=color:#719e07>)</span> /home/yahya/go/src/github.com/theyahya/go-pgo-playground/example1/main.go
</span></span><span style=display:flex><span>  main.go:9             0x4a32e0                493b6610                CMPQ SP, 0x10<span style=color:#719e07>(</span>R14<span style=color:#719e07>)</span>
</span></span><span style=display:flex><span>  main.go:9             0x4a32e4                0f86c1000000            JBE 0x4a33ab
</span></span><span style=display:flex><span>  main.go:9             0x4a32ea                <span style=color:#2aa198>55</span>                      PUSHQ BP
</span></span><span style=display:flex><span>  main.go:9             0x4a32eb                4889e5                  MOVQ SP, BP
</span></span><span style=display:flex><span>  main.go:9             0x4a32ee                4883ec50                SUBQ <span style=color:#268bd2>$0</span>x50, SP
</span></span><span style=display:flex><span>  main.go:9             0x4a32f2                440f117c2440            MOVUPS X15, 0x40<span style=color:#719e07>(</span>SP<span style=color:#719e07>)</span>
</span></span><span style=display:flex><span>  main.go:9             0x4a32f8                c644242700              MOVB <span style=color:#268bd2>$0</span>x0, 0x27<span style=color:#719e07>(</span>SP<span style=color:#719e07>)</span>
</span></span><span style=display:flex><span>  main.go:11            0x4a32fd                <span style=color:#2aa198>90</span>                      NOPL
</span></span><span style=display:flex><span>  file.go:323           0x4a32fe                488d05590b0200          LEAQ 0x20b59<span style=color:#719e07>(</span>IP<span style=color:#719e07>)</span>, AX
</span></span><span style=display:flex><span>  file.go:323           0x4a3305                bb0b000000              MOVL <span style=color:#268bd2>$0</span>xb, BX
</span></span><span style=display:flex><span>  file.go:323           0x4a330a                b942020000              MOVL <span style=color:#268bd2>$0</span>x242, CX
</span></span><span style=display:flex><span>  file.go:323           0x4a330f                bfb6010000              MOVL <span style=color:#268bd2>$0</span>x1b6, DI
</span></span><span style=display:flex><span>  file.go:323           0x4a3314                e88709feff              CALL os.OpenFile<span style=color:#719e07>(</span>SB<span style=color:#719e07>)</span>
</span></span><span style=display:flex><span>  main.go:12            0x4a3319                440f117c2430            MOVUPS X15, 0x30<span style=color:#719e07>(</span>SP<span style=color:#719e07>)</span>
</span></span><span style=display:flex><span>  main.go:12            0x4a331f                488d159a000000          LEAQ main.main.func1<span style=color:#719e07>(</span>SB<span style=color:#719e07>)</span>, DX
</span></span><span style=display:flex><span>  main.go:12            0x4a3326                <span style=color:#2aa198>4889542430</span>              MOVQ DX, 0x30<span style=color:#719e07>(</span>SP<span style=color:#719e07>)</span>
</span></span><span style=display:flex><span>  main.go:12            0x4a332b                <span style=color:#2aa198>4889442438</span>              MOVQ AX, 0x38<span style=color:#719e07>(</span>SP<span style=color:#719e07>)</span>
</span></span><span style=display:flex><span>  main.go:12            0x4a3330                488d542430              LEAQ 0x30<span style=color:#719e07>(</span>SP<span style=color:#719e07>)</span>, DX
</span></span><span style=display:flex><span>  main.go:12            0x4a3335                <span style=color:#2aa198>4889542448</span>              MOVQ DX, 0x48<span style=color:#719e07>(</span>SP<span style=color:#719e07>)</span>
</span></span><span style=display:flex><span>  main.go:12            0x4a333a                c644242701              MOVB <span style=color:#268bd2>$0</span>x1, 0x27<span style=color:#719e07>(</span>SP<span style=color:#719e07>)</span>
</span></span><span style=display:flex><span>  main.go:13            0x4a333f                4889c3                  MOVQ AX, BX
</span></span><span style=display:flex><span>  main.go:13            0x4a3342                488d05bf2d0400          LEAQ go:itab.*os.File,io.Writer<span style=color:#719e07>(</span>SB<span style=color:#719e07>)</span>, AX
</span></span><span style=display:flex><span>  main.go:13            0x4a3349                e89259ffff              CALL runtime/pprof.StartCPUProfile<span style=color:#719e07>(</span>SB<span style=color:#719e07>)</span>
</span></span><span style=display:flex><span>  main.go:14            0x4a334e                488d1503880200          LEAQ 0x28803<span style=color:#719e07>(</span>IP<span style=color:#719e07>)</span>, DX
</span></span><span style=display:flex><span>  main.go:14            0x4a3355                <span style=color:#2aa198>4889542440</span>              MOVQ DX, 0x40<span style=color:#719e07>(</span>SP<span style=color:#719e07>)</span>
</span></span><span style=display:flex><span>  main.go:14            0x4a335a                c644242703              MOVB <span style=color:#268bd2>$0</span>x3, 0x27<span style=color:#719e07>(</span>SP<span style=color:#719e07>)</span>
</span></span><span style=display:flex><span>  main.go:14            0x4a335f                31c0                    XORL AX, AX
</span></span><span style=display:flex><span>  main.go:16            0x4a3361                eb12                    JMP 0x4a3375
</span></span><span style=display:flex><span>  main.go:16            0x4a3363                <span style=color:#2aa198>4889442428</span>              MOVQ AX, 0x28<span style=color:#719e07>(</span>SP<span style=color:#719e07>)</span>
</span></span><span style=display:flex;background-color:#19404a><span>  main.go:17            0x4a3368                e8b3000000              CALL main.Func1<span style=color:#719e07>(</span>SB<span style=color:#719e07>)</span>
</span></span><span style=display:flex><span>  main.go:16            0x4a336d                488b442428              MOVQ 0x28<span style=color:#719e07>(</span>SP<span style=color:#719e07>)</span>, AX
</span></span><span style=display:flex><span>  main.go:16            0x4a3372                48ffc0                  INCQ AX
</span></span><span style=display:flex><span>  main.go:16            0x4a3375                483d40420f00            CMPQ AX, <span style=color:#268bd2>$0</span>xf4240
</span></span><span style=display:flex><span>  main.go:16            0x4a337b                7ee6                    JLE 0x4a3363
</span></span><span style=display:flex><span>  main.go:19            0x4a337d                c644242701              MOVB <span style=color:#268bd2>$0</span>x1, 0x27<span style=color:#719e07>(</span>SP<span style=color:#719e07>)</span>
</span></span><span style=display:flex><span>  main.go:19            0x4a3382                e8395dffff              CALL runtime/pprof.StopCPUProfile<span style=color:#719e07>(</span>SB<span style=color:#719e07>)</span>
</span></span><span style=display:flex><span>  main.go:19            0x4a3387                c644242700              MOVB <span style=color:#268bd2>$0</span>x0, 0x27<span style=color:#719e07>(</span>SP<span style=color:#719e07>)</span>
</span></span><span style=display:flex><span>  main.go:19            0x4a338c                488b542448              MOVQ 0x48<span style=color:#719e07>(</span>SP<span style=color:#719e07>)</span>, DX
</span></span><span style=display:flex><span>  main.go:19            0x4a3391                488b02                  MOVQ 0<span style=color:#719e07>(</span>DX<span style=color:#719e07>)</span>, AX
</span></span><span style=display:flex><span>  main.go:19            0x4a3394                ffd0                    CALL AX
</span></span><span style=display:flex><span>  main.go:19            0x4a3396                4883c450                ADDQ <span style=color:#268bd2>$0</span>x50, SP
</span></span><span style=display:flex><span>  main.go:19            0x4a339a                5d                      POPQ BP
</span></span><span style=display:flex><span>  main.go:19            0x4a339b                c3                      RET
</span></span><span style=display:flex><span>  main.go:19            0x4a339c                0f1f4000                NOPL 0<span style=color:#719e07>(</span>AX<span style=color:#719e07>)</span>
</span></span><span style=display:flex><span>  main.go:19            0x4a33a0                e8fbd5f8ff              CALL runtime.deferreturn<span style=color:#719e07>(</span>SB<span style=color:#719e07>)</span>
</span></span><span style=display:flex><span>  main.go:19            0x4a33a5                4883c450                ADDQ <span style=color:#268bd2>$0</span>x50, SP
</span></span><span style=display:flex><span>  main.go:19            0x4a33a9                5d                      POPQ BP
</span></span><span style=display:flex><span>  main.go:19            0x4a33aa                c3                      RET
</span></span><span style=display:flex><span>  main.go:9             0x4a33ab                e830a1fbff              CALL runtime.morestack_noctxt.abi0<span style=color:#719e07>(</span>SB<span style=color:#719e07>)</span>
</span></span><span style=display:flex><span>  main.go:9             0x4a33b0                e92bffffff              JMP main.main<span style=color:#719e07>(</span>SB<span style=color:#719e07>)</span></span></span></code></pre></td></tr></table></div></div></p><div class=highlight><div style=color:#93a1a1;background-color:#002b36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;display:grid><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;display:grid><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">41
</span><span style=background-color:#19404a><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">42
</span></span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">63
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;display:grid><code class=language-bash data-lang=bash><span style=display:flex><span>// after_pgo
</span></span><span style=display:flex><span>TEXT main.main<span style=color:#719e07>(</span>SB<span style=color:#719e07>)</span> /home/yahya/go/src/github.com/theyahya/go-pgo-playground/example1/main.go
</span></span><span style=display:flex><span>  main.go:9             0x4a3b80                493b6610                CMPQ SP, 0x10<span style=color:#719e07>(</span>R14<span style=color:#719e07>)</span>
</span></span><span style=display:flex><span>  main.go:9             0x4a3b84                0f86f2000000            JBE 0x4a3c7c
</span></span><span style=display:flex><span>  main.go:9             0x4a3b8a                <span style=color:#2aa198>55</span>                      PUSHQ BP
</span></span><span style=display:flex><span>  main.go:9             0x4a3b8b                4889e5                  MOVQ SP, BP
</span></span><span style=display:flex><span>  main.go:9             0x4a3b8e                4883ec60                SUBQ <span style=color:#268bd2>$0</span>x60, SP
</span></span><span style=display:flex><span>  main.go:9             0x4a3b92                440f117c2450            MOVUPS X15, 0x50<span style=color:#719e07>(</span>SP<span style=color:#719e07>)</span>
</span></span><span style=display:flex><span>  main.go:9             0x4a3b98                c644242700              MOVB <span style=color:#268bd2>$0</span>x0, 0x27<span style=color:#719e07>(</span>SP<span style=color:#719e07>)</span>
</span></span><span style=display:flex><span>  main.go:11            0x4a3b9d                <span style=color:#2aa198>90</span>                      NOPL
</span></span><span style=display:flex><span>  file.go:323           0x4a3b9e                488d05b9020200          LEAQ 0x202b9<span style=color:#719e07>(</span>IP<span style=color:#719e07>)</span>, AX
</span></span><span style=display:flex><span>  file.go:323           0x4a3ba5                bb0b000000              MOVL <span style=color:#268bd2>$0</span>xb, BX
</span></span><span style=display:flex><span>  file.go:323           0x4a3baa                b942020000              MOVL <span style=color:#268bd2>$0</span>x242, CX
</span></span><span style=display:flex><span>  file.go:323           0x4a3baf                bfb6010000              MOVL <span style=color:#268bd2>$0</span>x1b6, DI
</span></span><span style=display:flex><span>  file.go:323           0x4a3bb4                e84704feff              CALL os.OpenFile<span style=color:#719e07>(</span>SB<span style=color:#719e07>)</span>
</span></span><span style=display:flex><span>  main.go:12            0x4a3bb9                440f117c2430            MOVUPS X15, 0x30<span style=color:#719e07>(</span>SP<span style=color:#719e07>)</span>
</span></span><span style=display:flex><span>  main.go:12            0x4a3bbf                488d15da000000          LEAQ main.main.func1<span style=color:#719e07>(</span>SB<span style=color:#719e07>)</span>, DX
</span></span><span style=display:flex><span>  main.go:12            0x4a3bc6                <span style=color:#2aa198>4889542430</span>              MOVQ DX, 0x30<span style=color:#719e07>(</span>SP<span style=color:#719e07>)</span>
</span></span><span style=display:flex><span>  main.go:12            0x4a3bcb                <span style=color:#2aa198>4889442438</span>              MOVQ AX, 0x38<span style=color:#719e07>(</span>SP<span style=color:#719e07>)</span>
</span></span><span style=display:flex><span>  main.go:12            0x4a3bd0                488d542430              LEAQ 0x30<span style=color:#719e07>(</span>SP<span style=color:#719e07>)</span>, DX
</span></span><span style=display:flex><span>  main.go:12            0x4a3bd5                <span style=color:#2aa198>4889542458</span>              MOVQ DX, 0x58<span style=color:#719e07>(</span>SP<span style=color:#719e07>)</span>
</span></span><span style=display:flex><span>  main.go:12            0x4a3bda                c644242701              MOVB <span style=color:#268bd2>$0</span>x1, 0x27<span style=color:#719e07>(</span>SP<span style=color:#719e07>)</span>
</span></span><span style=display:flex><span>  main.go:13            0x4a3bdf                4889c3                  MOVQ AX, BX
</span></span><span style=display:flex><span>  main.go:13            0x4a3be2                488d052f260400          LEAQ go:itab.*os.File,io.Writer<span style=color:#719e07>(</span>SB<span style=color:#719e07>)</span>, AX
</span></span><span style=display:flex><span>  main.go:13            0x4a3be9                e89259ffff              CALL runtime/pprof.StartCPUProfile<span style=color:#719e07>(</span>SB<span style=color:#719e07>)</span>
</span></span><span style=display:flex><span>  main.go:14            0x4a3bee                488d15637f0200          LEAQ 0x27f63<span style=color:#719e07>(</span>IP<span style=color:#719e07>)</span>, DX
</span></span><span style=display:flex><span>  main.go:14            0x4a3bf5                <span style=color:#2aa198>4889542450</span>              MOVQ DX, 0x50<span style=color:#719e07>(</span>SP<span style=color:#719e07>)</span>
</span></span><span style=display:flex><span>  main.go:14            0x4a3bfa                c644242703              MOVB <span style=color:#268bd2>$0</span>x3, 0x27<span style=color:#719e07>(</span>SP<span style=color:#719e07>)</span>
</span></span><span style=display:flex><span>  main.go:14            0x4a3bff                31c0                    XORL AX, AX
</span></span><span style=display:flex><span>  main.go:16            0x4a3c01                eb47                    JMP 0x4a3c4a
</span></span><span style=display:flex><span>  main.go:16            0x4a3c03                488d5001                LEAQ 0x1<span style=color:#719e07>(</span>AX<span style=color:#719e07>)</span>, DX
</span></span><span style=display:flex><span>  main.go:16            0x4a3c07                <span style=color:#2aa198>4889542428</span>              MOVQ DX, 0x28<span style=color:#719e07>(</span>SP<span style=color:#719e07>)</span>
</span></span><span style=display:flex><span>  main.go:17            0x4a3c0c                <span style=color:#2aa198>90</span>                      NOPL
</span></span><span style=display:flex><span>  main.go:22            0x4a3c0d                440f117c2440            MOVUPS X15, 0x40<span style=color:#719e07>(</span>SP<span style=color:#719e07>)</span>
</span></span><span style=display:flex><span>  main.go:22            0x4a3c13                488d35868a0000          LEAQ 0x8a86<span style=color:#719e07>(</span>IP<span style=color:#719e07>)</span>, SI
</span></span><span style=display:flex><span>  main.go:22            0x4a3c1a                <span style=color:#2aa198>4889742440</span>              MOVQ SI, 0x40<span style=color:#719e07>(</span>SP<span style=color:#719e07>)</span>
</span></span><span style=display:flex><span>  main.go:22            0x4a3c1f                488d3dea200400          LEAQ 0x420ea<span style=color:#719e07>(</span>IP<span style=color:#719e07>)</span>, DI
</span></span><span style=display:flex><span>  main.go:22            0x4a3c26                48897c2448              MOVQ DI, 0x48<span style=color:#719e07>(</span>SP<span style=color:#719e07>)</span>
</span></span><span style=display:flex><span>  main.go:22            0x4a3c2b                488d442440              LEAQ 0x40<span style=color:#719e07>(</span>SP<span style=color:#719e07>)</span>, AX
</span></span><span style=display:flex><span>  main.go:22            0x4a3c30                bb01000000              MOVL <span style=color:#268bd2>$0</span>x1, BX
</span></span><span style=display:flex><span>  main.go:22            0x4a3c35                4889d9                  MOVQ BX, CX
</span></span><span style=display:flex;background-color:#19404a><span>  main.go:22            0x4a3c38                e8234dfeff              CALL fmt.Println<span style=color:#719e07>(</span>SB<span style=color:#719e07>)</span>
</span></span><span style=display:flex><span>  main.go:22            0x4a3c3d                0f1f00                  NOPL 0<span style=color:#719e07>(</span>AX<span style=color:#719e07>)</span>
</span></span><span style=display:flex><span>  main.go:23            0x4a3c40                e8bb000000              CALL main.Func2<span style=color:#719e07>(</span>SB<span style=color:#719e07>)</span>
</span></span><span style=display:flex><span>  main.go:16            0x4a3c45                488b442428              MOVQ 0x28<span style=color:#719e07>(</span>SP<span style=color:#719e07>)</span>, AX
</span></span><span style=display:flex><span>  main.go:16            0x4a3c4a                483d40420f00            CMPQ AX, <span style=color:#268bd2>$0</span>xf4240
</span></span><span style=display:flex><span>  main.go:16            0x4a3c50                7eb1                    JLE 0x4a3c03
</span></span><span style=display:flex><span>  main.go:19            0x4a3c52                c644242701              MOVB <span style=color:#268bd2>$0</span>x1, 0x27<span style=color:#719e07>(</span>SP<span style=color:#719e07>)</span>
</span></span><span style=display:flex><span>  main.go:19            0x4a3c57                e8045dffff              CALL runtime/pprof.StopCPUProfile<span style=color:#719e07>(</span>SB<span style=color:#719e07>)</span>
</span></span><span style=display:flex><span>  main.go:19            0x4a3c5c                c644242700              MOVB <span style=color:#268bd2>$0</span>x0, 0x27<span style=color:#719e07>(</span>SP<span style=color:#719e07>)</span>
</span></span><span style=display:flex><span>  main.go:19            0x4a3c61                488b542458              MOVQ 0x58<span style=color:#719e07>(</span>SP<span style=color:#719e07>)</span>, DX
</span></span><span style=display:flex><span>  main.go:19            0x4a3c66                488b02                  MOVQ 0<span style=color:#719e07>(</span>DX<span style=color:#719e07>)</span>, AX
</span></span><span style=display:flex><span>  main.go:19            0x4a3c69                ffd0                    CALL AX
</span></span><span style=display:flex><span>  main.go:19            0x4a3c6b                4883c460                ADDQ <span style=color:#268bd2>$0</span>x60, SP
</span></span><span style=display:flex><span>  main.go:19            0x4a3c6f                5d                      POPQ BP
</span></span><span style=display:flex><span>  main.go:19            0x4a3c70                c3                      RET
</span></span><span style=display:flex><span>  main.go:19            0x4a3c71                e80acdf8ff              CALL runtime.deferreturn<span style=color:#719e07>(</span>SB<span style=color:#719e07>)</span>
</span></span><span style=display:flex><span>  main.go:19            0x4a3c76                4883c460                ADDQ <span style=color:#268bd2>$0</span>x60, SP
</span></span><span style=display:flex><span>  main.go:19            0x4a3c7a                5d                      POPQ BP
</span></span><span style=display:flex><span>  main.go:19            0x4a3c7b                c3                      RET
</span></span><span style=display:flex><span>  main.go:9             0x4a3c7c                0f1f4000                NOPL 0<span style=color:#719e07>(</span>AX<span style=color:#719e07>)</span>
</span></span><span style=display:flex><span>  main.go:9             0x4a3c80                e83b9afbff              CALL runtime.morestack_noctxt.abi0<span style=color:#719e07>(</span>SB<span style=color:#719e07>)</span>
</span></span><span style=display:flex><span>  main.go:9             0x4a3c85                e9f6feffff              JMP main.main<span style=color:#719e07>(</span>SB<span style=color:#719e07>)</span></span></span></code></pre></td></tr></table></div></div><p>In line #32 in <code>before_pgo</code> it&rsquo;s calling <code>Func1</code> but in <code>after_pgo</code> it&rsquo;s being inlined.</p><h2 id=a-more-realistic-example-api>A more realistic example (API)</h2><p>Now that we&rsquo;ve got a grasp of what&rsquo;s going on, let&rsquo;s do a more realistic example; an http endpoint which returns a simple json. I&rsquo;m going to use <code>github.com/json-iterator/go</code> which I found out about a couple days ago in one of my endless github explorations!</p><div class=highlight><div style=color:#93a1a1;background-color:#002b36;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">48
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#719e07>package</span> main
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#719e07>import</span> (
</span></span><span style=display:flex><span>	<span style=color:#2aa198>&#34;log&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#2aa198>&#34;net/http&#34;</span>
</span></span><span style=display:flex><span>	_ <span style=color:#2aa198>&#34;net/http/pprof&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#2aa198>&#34;os&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	jsoniter <span style=color:#2aa198>&#34;github.com/json-iterator/go&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#268bd2>type</span> Data <span style=color:#268bd2>struct</span> {
</span></span><span style=display:flex><span>	Quiz <span style=color:#268bd2>struct</span> {
</span></span><span style=display:flex><span>		Sport <span style=color:#268bd2>struct</span> {
</span></span><span style=display:flex><span>			Q1 <span style=color:#268bd2>struct</span> {
</span></span><span style=display:flex><span>				Question <span style=color:#dc322f>string</span>   <span style=color:#2aa198>`json:&#34;question&#34;`</span>
</span></span><span style=display:flex><span>				Options  []<span style=color:#dc322f>string</span> <span style=color:#2aa198>`json:&#34;options&#34;`</span>
</span></span><span style=display:flex><span>				Answer   <span style=color:#dc322f>string</span>   <span style=color:#2aa198>`json:&#34;answer&#34;`</span>
</span></span><span style=display:flex><span>			} <span style=color:#2aa198>`json:&#34;q1&#34;`</span>
</span></span><span style=display:flex><span>		} <span style=color:#2aa198>`json:&#34;sport&#34;`</span>
</span></span><span style=display:flex><span>		Maths <span style=color:#268bd2>struct</span> {
</span></span><span style=display:flex><span>			Q1 <span style=color:#268bd2>struct</span> {
</span></span><span style=display:flex><span>				Question <span style=color:#dc322f>string</span>   <span style=color:#2aa198>`json:&#34;question&#34;`</span>
</span></span><span style=display:flex><span>				Options  []<span style=color:#dc322f>string</span> <span style=color:#2aa198>`json:&#34;options&#34;`</span>
</span></span><span style=display:flex><span>				Answer   <span style=color:#dc322f>string</span>   <span style=color:#2aa198>`json:&#34;answer&#34;`</span>
</span></span><span style=display:flex><span>			} <span style=color:#2aa198>`json:&#34;q1&#34;`</span>
</span></span><span style=display:flex><span>			Q2 <span style=color:#268bd2>struct</span> {
</span></span><span style=display:flex><span>				Question <span style=color:#dc322f>string</span>   <span style=color:#2aa198>`json:&#34;question&#34;`</span>
</span></span><span style=display:flex><span>				Options  []<span style=color:#dc322f>string</span> <span style=color:#2aa198>`json:&#34;options&#34;`</span>
</span></span><span style=display:flex><span>				Answer   <span style=color:#dc322f>string</span>   <span style=color:#2aa198>`json:&#34;answer&#34;`</span>
</span></span><span style=display:flex><span>			} <span style=color:#2aa198>`json:&#34;q2&#34;`</span>
</span></span><span style=display:flex><span>		} <span style=color:#2aa198>`json:&#34;maths&#34;`</span>
</span></span><span style=display:flex><span>	} <span style=color:#2aa198>`json:&#34;quiz&#34;`</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#268bd2>func</span> <span style=color:#268bd2>main</span>() {
</span></span><span style=display:flex><span>	http.<span style=color:#268bd2>HandleFunc</span>(<span style=color:#2aa198>&#34;/&#34;</span>, handler)
</span></span><span style=display:flex><span>	log.<span style=color:#268bd2>Fatal</span>(http.<span style=color:#268bd2>ListenAndServe</span>(<span style=color:#2aa198>&#34;:8080&#34;</span>, <span style=color:#cb4b16>nil</span>))
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#268bd2>func</span> <span style=color:#268bd2>handler</span>(w http.ResponseWriter, r <span style=color:#719e07>*</span>http.Request) {
</span></span><span style=display:flex><span>	<span style=color:#268bd2>var</span> json = jsoniter.ConfigCompatibleWithStandardLibrary
</span></span><span style=display:flex><span>	file, _ <span style=color:#719e07>:=</span> os.<span style=color:#268bd2>ReadFile</span>(<span style=color:#2aa198>&#34;./data.json&#34;</span>)
</span></span><span style=display:flex><span>	data <span style=color:#719e07>:=</span> Data{}
</span></span><span style=display:flex><span>	json.<span style=color:#268bd2>Unmarshal</span>(file, <span style=color:#719e07>&amp;</span>data)
</span></span><span style=display:flex><span>	d, _ <span style=color:#719e07>:=</span> json.<span style=color:#268bd2>Marshal</span>(data)
</span></span><span style=display:flex><span>	w.<span style=color:#268bd2>Write</span>(d)
</span></span><span style=display:flex><span>}</span></span></code></pre></td></tr></table></div></div><p>It&rsquo;s a simple endpoint that reads a <code>.json</code> file and unmarshal and marshal (we do this to create some fake overhead to this endpoint) again and then write it to response. I also Added <code>net/http/pprof</code> to be able to collect profile data.</p><p>Now we can <code>go build -o before_pgo ./main.go</code> and then run it by <code>./before_pgo</code>. While it&rsquo;s up we create traffic with <code>go-wrk -d 20 http://localhost:8080</code> (Check out <a href=https://github.com/tsliwowicz/go-wrk>github.com/tsliwowicz/go-wrk</a>). And while the traffic is going through, we can collect the profile data for 10 seconds with <code>curl -o default.pgo "http://localhost:8080/debug/pprof/profile?seconds=10"</code></p><p>Result of <code>go-wrk</code> command should be something like this:</p><div class=highlight><div style=color:#93a1a1;background-color:#002b36;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>Running 20s <span style=color:#b58900>test</span> @ http://localhost:8080
</span></span><span style=display:flex><span>  <span style=color:#2aa198>10</span> goroutine<span style=color:#719e07>(</span>s<span style=color:#719e07>)</span> running concurrently
</span></span><span style=display:flex><span><span style=color:#2aa198>747453</span> requests in 19.582312899s, 322.20MB <span style=color:#b58900>read</span>
</span></span><span style=display:flex><span>Requests/sec:           38169.80
</span></span><span style=display:flex><span>Transfer/sec:           16.45MB
</span></span><span style=display:flex><span>Avg Req Time:           261.987Âµs
</span></span><span style=display:flex><span>Fastest Request:        33.156Âµs
</span></span><span style=display:flex><span>Slowest Request:        15.862181ms
</span></span><span style=display:flex><span>Number of Errors:       <span style=color:#2aa198>0</span></span></span></code></pre></td></tr></table></div></div><p>Now let&rsquo;s recompile our code with the profile data that we have and then run the benchmark again and compare the results. With <code>go build -o after_pgo ./main.go</code> and checking the files that we have, we can see that the size of the binary is already 200KB bigger and this means that probably lots of inlining should&rsquo;ve happened there!</p><div class=highlight><div style=color:#93a1a1;background-color:#002b36;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>-rwxr-xr-x <span style=color:#2aa198>1</span> yahya yahya 8.3M Aug <span style=color:#2aa198>22</span> 17:35 before_pgo
</span></span><span style=display:flex><span>-rw-r--r-- <span style=color:#2aa198>1</span> yahya yahya  60K Aug <span style=color:#2aa198>22</span> 17:38 default.pgo
</span></span><span style=display:flex><span>-rw-r--r-- <span style=color:#2aa198>1</span> yahya yahya <span style=color:#2aa198>1017</span> Aug <span style=color:#2aa198>22</span> 17:47 main.go
</span></span><span style=display:flex><span>drwxr-xr-x <span style=color:#2aa198>2</span> yahya yahya 4.0K Aug <span style=color:#2aa198>22</span> 18:21 .
</span></span><span style=display:flex><span>-rwxr-xr-x <span style=color:#2aa198>1</span> yahya yahya 8.5M Aug <span style=color:#2aa198>22</span> 18:21 after_pgo</span></span></code></pre></td></tr></table></div></div><p>And this is the <code>go-wrk</code> result.</p><div class=highlight><div style=color:#93a1a1;background-color:#002b36;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>Running 20s <span style=color:#b58900>test</span> @ http://localhost:8080
</span></span><span style=display:flex><span>  <span style=color:#2aa198>10</span> goroutine<span style=color:#719e07>(</span>s<span style=color:#719e07>)</span> running concurrently
</span></span><span style=display:flex><span><span style=color:#2aa198>821349</span> requests in 19.574756327s, 354.05MB <span style=color:#b58900>read</span>
</span></span><span style=display:flex><span>Requests/sec:           41959.60
</span></span><span style=display:flex><span>Transfer/sec:           18.09MB
</span></span><span style=display:flex><span>Avg Req Time:           238.324Âµs
</span></span><span style=display:flex><span>Fastest Request:        28.559Âµs
</span></span><span style=display:flex><span>Slowest Request:        12.996215ms
</span></span><span style=display:flex><span>Number of Errors:       <span style=color:#2aa198>0</span></span></span></code></pre></td></tr></table></div></div><p>Not bad! Increased number of requests that we can handle by almost 4,000.</p><p>If you&rsquo;re interested about how compiler does these magics, I recommend you to check out these first commits in go project:</p><p><a href=https://github.com/golang/go/commit/99862cd57dd9406180f238e8fa2fcc1d435fb163>https://github.com/golang/go/commit/99862cd57dd9406180f238e8fa2fcc1d435fb163</a>.</p><p>It&rsquo;s the first commit of PGO implementation in the Go compiler and only by scrolling you can get a grasp of how it&rsquo;s working and how it&rsquo;s checking for hot nodes in AST.</p><h2 id=automation--workflow>Automation & Workflow</h2><p>For profile data to be completely accurate and useful, it needs to come from production with real traffic. But itâ€™s hard to keep an updated profile and constantly replace it. It also could easily become stale or even if you have a big refactor with big changes, your previous profile data from production isnâ€™t useful to compile your code with.</p><p>With less than 5% overhead, Itâ€™s safe to use profiler in your production. Even major cloud providers like GCP <a href=https://cloud.google.com/profiler/docs/profiling-go>offer solutions</a> to collect your profile data from their native cloud products with a nice dashboard to see the results. Itâ€™s also very helpful in cases that youâ€™ve goroutine/memory leak or trying to debug any performance related issue that is only happening in production and hard to reproduce locally!</p><p>With that out of the way (having profiler as a default in your code), Automating your builds to use profile data and, as <a href=https://go.googlesource.com/proposal/+/master/design/55022-pgo.md>the design proposal</a> offers: having it in your git history as a file (<code>default.pgo</code>) could be an overkill. But if you really care about performance or/and cost, and youâ€™ve exhausted all the other improvements, this could be your chance to make it perfect!</p><h2 id=code>Code</h2><p>You can find all the codes that we wrote in this post and the related files and benchmarks in this github repo: <a href=https://github.com/theyahya/go-pgo-playground>github.com/theyahya/go-pgo-playground</a></p><p>If you like these kind of topics, join my <a href=https://theyahya.substack.com/>ðŸ“® Newsletter</a> to receive similar articles every once in a while, there won&rsquo;t be any spams! promise!</p><h2 id=recommended-related-reading>Recommended related reading</h2><p>Still interested and curious about the PGO and how it works and you want to follow the rabbit hole? I recommend the following links:</p><ol><li>PGO related commits in go compiler: <a href=https://github.com/golang/go/commits/master/src/cmd/compile/internal/pgo>https://github.com/golang/go/commits/master/src/cmd/compile/internal/pgo</a></li><li><a href=https://research.google/pubs/pub45290/>AutoFDO: Automatic Feedback-Directed Optimization for Warehouse-Scale Applications</a></li><li><a href=https://go.googlesource.com/proposal/+/master/design/55022-pgo.md>Proposal: profile-guided optimization</a></li><li><a href="https://learn.microsoft.com/en-us/cpp/build/profile-guided-optimizations?view=msvc-170">Profile-guided optimizations</a></li></ol></div></article><div id=footer-post-container><div id=footer-post><div id=nav-footer style=display:none><ul><li><a href=/>Home</a></li><li><a href=/about>About</a></li><li><a href=https://theyahya.substack.com/>ðŸ“® Newsletter</a></li></ul></div><div id=share-footer style=display:none><ul><li><a class=icon href="http://www.facebook.com/sharer.php?u=https%3a%2f%2ftheyahya.com%2fposts%2fgo-pgo%2f" aria-label=Facebook><i class="fab fa-facebook fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://twitter.com/share?url=https%3a%2f%2ftheyahya.com%2fposts%2fgo-pgo%2f&text=A%20Deep%20Look%20Into%20Golang%20Profile-Guided%20Optimization%20%28PGO%29" aria-label=Twitter><i class="fab fa-twitter fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2ftheyahya.com%2fposts%2fgo-pgo%2f&title=A%20Deep%20Look%20Into%20Golang%20Profile-Guided%20Optimization%20%28PGO%29" aria-label=Linkedin><i class="fab fa-linkedin fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2ftheyahya.com%2fposts%2fgo-pgo%2f&is_video=false&description=A%20Deep%20Look%20Into%20Golang%20Profile-Guided%20Optimization%20%28PGO%29" aria-label=Pinterest><i class="fab fa-pinterest fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="mailto:?subject=A%20Deep%20Look%20Into%20Golang%20Profile-Guided%20Optimization%20%28PGO%29&body=Check out this article: https%3a%2f%2ftheyahya.com%2fposts%2fgo-pgo%2f" aria-label=Email><i class="fas fa-envelope fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://getpocket.com/save?url=https%3a%2f%2ftheyahya.com%2fposts%2fgo-pgo%2f&title=A%20Deep%20Look%20Into%20Golang%20Profile-Guided%20Optimization%20%28PGO%29" aria-label=Pocket><i class="fab fa-get-pocket fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://reddit.com/submit?url=https%3a%2f%2ftheyahya.com%2fposts%2fgo-pgo%2f&title=A%20Deep%20Look%20Into%20Golang%20Profile-Guided%20Optimization%20%28PGO%29" aria-label=reddit><i class="fab fa-reddit fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.tumblr.com/share/link?url=https%3a%2f%2ftheyahya.com%2fposts%2fgo-pgo%2f&name=A%20Deep%20Look%20Into%20Golang%20Profile-Guided%20Optimization%20%28PGO%29&description=Intro%20Profile-Guided%20Optimization%20%28PGO%29%20is%20an%20optimization%20method%20which%20improves%20final%20compiled%20binary%20by%20using%20profile%20data%20hints%20and%20compiling%20the%20code%20based%20on%20those%20profiles.%0aThere%20are%20several%20optimization%20mechanisms%20that%20compilers%20usually%20get%20into%20account%20when%20compiling%20your%20code%20to%20binary.%20Like%20dead%20code%20elimination%2c%20Register%20allocation%2c%20Constant%20folding%20or%20function%20inlining%3b%20you%20may%20split%20your%20code%20into%20smaller%20and%20smaller%20functions%20and%20different%20level%20of%20abstractions%20to%20ease%20up%20future%20changes%20and%20modifications%2c%20but%20from%20compiler%20point%20of%20view%20multiple%20calls%20to%20different%20functions%20may%20not%20be%20very%20optimize%20and%20sometimes%20compiler%20decides%20to%20inline%20your%20functions%21" aria-label=Tumblr><i class="fab fa-tumblr fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2ftheyahya.com%2fposts%2fgo-pgo%2f&t=A%20Deep%20Look%20Into%20Golang%20Profile-Guided%20Optimization%20%28PGO%29" aria-label="Hacker News"><i class="fab fa-hacker-news fa-lg" aria-hidden=true></i></a></li></ul></div><div id=actions-footer><a id=menu-toggle class=icon href=# onclick='return $("#nav-footer").toggle(),!1' aria-label=Menu><i class="fas fa-bars fa-lg" aria-hidden=true></i> Menu</a>
<a id=share-toggle class=icon href=# onclick='return $("#share-footer").toggle(),!1' aria-label=Share><i class="fas fa-share-alt fa-lg" aria-hidden=true></i> share</a>
<a id=top style=display:none class=icon href=# onclick='$("html, body").animate({scrollTop:0},"fast")' aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg" aria-hidden=true></i> Top</a></div></div></div><footer id=footer><div class=footer-left>Copyright &copy; 2024 Yahya SayadArbabi - Blog</div><div class=footer-right><nav><ul><li><a href=/>Home</a></li><li><a href=/about>About</a></li><li><a href=https://theyahya.substack.com/>ðŸ“® Newsletter</a></li></ul></nav></div></footer></div></body><link rel=stylesheet href=/lib/font-awesome/css/all.min.css><script src=/lib/jquery/jquery.min.js></script>
<script src=/js/main.js></script>
<script src=/js/code-copy.js></script></html>